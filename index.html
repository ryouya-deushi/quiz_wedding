<!DOCTYPE html>
<html lang="ja">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Welcome to Our Wedding Party</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			text-align: center;
			margin: 20px;
		}
		.input-section {
			display: none;
		}
		
		.red-text {
		  color: red;
		}

		.radioColor>label:hover{
		    color: red;
		}
		
		.input-section label {
		    display: flex;
		    align-items: center;
		    margin-bottom: 10px;
		}
		
		.input-section input[type="radio"] {
		    margin-right: 10px;
		}
		
		.box2-2 {
			padding:2em;/*内側余白*/
			border-left:solid 5px #e9b3a3;/*線の種類・太さ・色*/
			background-color:#F9F8F8;/*背景色*/
			box-shadow:3px 1px 4px rgb(0 0 0 / .2);
		}

		h1 {
			position: relative;
			display: inline-block;
			padding: 0 55px;
		}
		h1:before, h1:after {
			content: '';
			position: absolute;
			top: 50%;
			display: inline-block;
			width: 45px;
			height: 2px;
			border-top: solid 1px black;
			border-bottom: solid 1px black;
		}
		h1:before {
			left:0;
		}
		h1:after {
			right: 0;
		}
		
		span.marker {
		    background: linear-gradient(transparent 50%, #e9b3a3 50%);
		}
		
		.styled-button {
            background-color: #e9b3a3; /* 緑色の背景 */
            border: none; /* 枠線を消す */
            color: white; /* 文字色を白に */
            padding: 15px 32px; /* パディング */
            text-align: center; /* テキストを中央に */
            text-decoration: none; /* 下線を消す */
            display: inline-block; /* インラインブロック要素に */
            font-size: 16px; /* フォントサイズ */
            margin: 4px 2px; /* マージン */
            cursor: pointer; /* カーソルをポインターに */
            border-radius: 12px; /* 角を丸く */
            transition: background-color 0.3s ease; /* 背景色の変化にトランジションを追加 */
        }

        .styled-button:hover {
            background-color: #d89a8a; /* ホバー時の背景色 */
        }
        
        .styled-button-notback {
            background-color: #4CAF50; /* 緑色の背景 */
            border: none; /* 枠線を消す */
            color: white; /* 文字色を白に */
            padding: 15px 32px; /* パディング */
            text-align: center; /* テキストを中央に */
            text-decoration: none; /* 下線を消す */
            display: inline-block; /* インラインブロック要素に */
            font-size: 16px; /* フォントサイズ */
            margin: 4px 2px; /* マージン */
            cursor: pointer; /* カーソルをポインターに */
            border-radius: 12px; /* 角を丸く */
            transition: background-color 0.3s ease; /* 背景色の変化にトランジションを追加 */
        }

        .styled-button-notback:hover {
            background-color: #45a049; /* ホバー時の背景色 */
        }
        
        .styled-button-notback:disabled {
            background-color: #a5d6a7; /* 無効化されたボタンの背景色 */
            cursor: not-allowed; /* カーソルを禁止マークに */
            opacity: 0.6; /* 透明度を下げる */
        }
        

	</style>
</head>

<body>
	<h1>Quiz</h1>
	<div id="loginSection" class="input-section">
		<p>パスワードを入力してください：</p>
		<input type="text" id="passwdBox" placeholder="ここに入力してください"><br><br>
		<input type="button" id="passwdBtn" value="Enter" onclick="receiveForm()" class="styled-button-notback">
		<p id="resultBox"></p>
	</div>

	<form id="testForm">
		<div id="inputNameSection" class="input-section button013">
			<p>名前を入力してください：</p>
			<input type="text" id="inputNameBox" name="inputNameBox" placeholder="ここに入力してください"><br><br>
			<input type="button" id="inputNameBtn" value="Next>" onclick="startQuiz('questionContainer1')" class="styled-button">
		</div>

		<!-- 質問1-->
		<div id="questionContainer1" class="input-section button013">
			<h2 id="welcomeMessage"></h2>
			<h2>クイズにご参加いただきありがとうございます！</h2>
			<h3><span class="marker">クイズは全部で10問</span></h3>
			<h3><span class="marker">高得点の人には景品があるかも？</span></h3>
			<div id="q1" class="radioColor box2-2">
		        <p>Q1: 好きな犬は？</p>
		        
			    <label><input type="radio" name="question1" value="ぽめぽめ"> ぽめぽめ</label><br>
			    <label><input type="radio" name="question1" value="ぽにお"> ぽにお</label><br>
			    <label><input type="radio" name="question1" value="ぷにこ"> ぷにこ</label><br>
			    <label><input type="radio" name="question1" value="ぴよ"> ぴよ</label><br>

				<input type="button" id="preBtn1" value="<Back" onclick="showPreviousSection()" class="styled-button">
				<input type="button" id="nextBtn1" value="Next>" onclick="showNextSection('questionContainer2', 'question1')" class="styled-button">
			</div>
	    </div>

	    <!-- 質問2-->
	    <div id="questionContainer2" class="input-section radioColor box2-2">
	        <p>Q2: 好きな呪文は？</p>
	        
	        <label><input type="radio" name="question2" value="リベリオ">リベリオ</label>
	        <label><input type="radio" name="question2" value="インセンディオ">インセンディオ</label>
	        <label><input type="radio" name="question2" value="アダバケダブラ">アダバケダブラ</label>
	        <label><input type="radio" name="question2" value="ルーモス">ルーモス</label>

	        <input type="button" id="preBtn2" value="<Back" onclick="showPreviousSection()" class="styled-button">
			<input type="button" id="nextBtn2" value="Next>" onclick="showNextSection('questionContainer3', 'question2')" class="styled-button">
	    </div>

		<!-- 質問3-->
	    <div id="questionContainer3" class="input-section radioColor box2-2">
	        <p>Q3: 好きなポケモンは？</p>
	        
	        <label><input type="radio" name="question3" value="イーブイ">イーブイ</label>
	        <label><input type="radio" name="question3" value="パモ">パモ</label>
	        <label><input type="radio" name="question3" value="デデンネ">デデンネ</label>
	        <label><input type="radio" name="question3" value="オーガポン">オーガポン</label>

	        <input type="button" id="preBtn3" value="<Back" onclick="showPreviousSection()" class="styled-button">
			<input type="button" id="submitBtn" value="Submit" onclick="submitForm('question3')" class="styled-button-notback">
	    </div>

	</form>

	<div id="exitSection" class="input-section">
	<h2>ご回答ありがとうございました</h2><br>
	<h2>Have a great time!!!</h2><br>
	<h3 class="red-text">※二回目の回答はお控えください</h3>
	
	</div>

	<script>
		document.getElementById('loginSection').style.display = 'block';
		
		function authenticate(sectionId) {
			const currentSection = document.querySelector('.input-section:not([style*="display: none"])');
			if (currentSection) {
				sectionHistory.push(currentSection.id);
				currentSection.style.display = 'none';
			}
			document.getElementById(sectionId).style.display = 'block';
		}

		const sectionHistory = [];
		function showNextSection(sectionId, questionName) {
			const selectedOption = document.querySelector(`input[name="${questionName}"]:checked`);
			if (!selectedOption) {
				alert("選択してください");
				return;
			}

			const currentSection = document.querySelector('.input-section:not([style*="display: none"])');
			if (currentSection) {
				sectionHistory.push(currentSection.id);
				currentSection.style.display = 'none';
			}
			document.getElementById(sectionId).style.display = 'block';
		}

		function showPreviousSection() {
			if (sectionHistory.length > 0) {
				const previousSectionId = sectionHistory.pop();
				const currentSection = document.querySelector('.input-section:not([style*="display: none"])');
				if (currentSection) {
					currentSection.style.display = 'none';
				}
				
				document.getElementById(previousSectionId).style.display = 'block';
			}
		}
		
		
		function startQuiz(sectionId) {
			let name = document.getElementById("inputNameBox").value;
			if (name.trim() === "") {
				alert("名前を入力してください。");
				return;
			} else if (name.length > 10) {
				alert("名前は10文字以内で入力してください。");
				return;
			}
			document.getElementById("welcomeMessage").innerText = `${name}様`;
			authenticate(sectionId);
		}
		
		
		const url = "https://script.google.com/macros/s/AKfycbzL31iwqTDoJdt-n17ACUcm75dl68Uy5YvHgoPtWZWsqVvEJMVfjcNY3ybA3rrbznbswg/exec";
		function receiveForm() {
			document.getElementById("passwdBtn").disabled = true;

			const inputValue = document.getElementById('passwdBox').value;

			const GET_options = {
				method: "GET",
			};

			fetch(url, GET_options)
			.then(response => response.json())
			.then(data => {
			const cellValue = data.cellValue;
			if (inputValue == cellValue) {
				authenticate('inputNameSection');
			} else {
			  document.getElementById("resultBox").innerText = "パスワードが間違っています。再度入力してください。";
			  document.getElementById("passwdBtn").disabled = false;
			}
			})
			.catch((error) => {console.error('Error:', error);});
		}
		
		function submitForm() {
			document.getElementById("submitBtn").disabled = true;
			const formData = new FormData(document.getElementById('testForm'));
			const data = {};
			formData.forEach((value, key) => {
				data[key] = value;
			});

			const POST_options = {
				method: "POST",
				body: JSON.stringify(data),
			};

			fetch(url, POST_options)
			.then(response => response.json())
			.then(response => {
	            if (response.result === true) {
	            	showNextSection('exitSection', 'question2');
	            } else {
	                alert("送信失敗。もう一度試してください。");
	                document.getElementById("submitBtn").disabled = false;
	            }
	        })
	        .catch(error => {
	            console.error('Error:', error);
	            alert("エラーが発生しました。もう一度試してください。");
	            document.getElementById("submitBtn").disabled = false;
	        });
	    }

	</script>
</body>
</html>
