<!DOCTYPE html>
<html lang="ja">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>クイズ</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			text-align: center;
			margin: 20px;
		}
		.question {
			margin-bottom: 15px;
		}
		.input-section {
			display: none;
		}
	</style>
</head>
<body>
	<h1>クイズ</h1>
	<div id="loginSection" class="input-section">
		<p>パスワードを入力してください：</p>
		<input type="text" id="passwdBox" placeholder="ここに入力してください">
		<input type="button" id="passwdBtn" value="認証" onclick="receiveForm()">
		<p id="resultBox"></p>
	</div>
	<form id="testForm">
		<div id="inputNameSection" class="input-section">
			<p>名前を入力してください：</p>
			<input type="text" id="inputNameBox" name="inputNameBox" placeholder="ここに入力してください"><br><br>
			<input type="button" id="inputNameBtn" value="完了" onclick="startQuiz('questionContainer1')">
		</div>
		<!-- 質問1-->
		<div id="questionContainer1" class="input-section">
			<h2 id="welcomeMessage"></h2>
	        <p>質問1: 日本の首都は？</p>
	        <input type="radio" id="q1_a" name="question1" value="大阪">
	        <label for="q1_a">大阪</label><br>

	        <input type="radio" id="q1_b" name="question1" value="東京">
	        <label for="q1_b">東京</label><br>

	        <input type="radio" id="q1_c" name="question1" value="京都">
	        <label for="q1_c">京都</label><br><br>

	        <input type="button" id="nextBtn1" value="次へ" onclick="showNextSection('questionContainer2')">
	    </div>
	    <!-- 質問2-->
	    <div id="questionContainer2" class="input-section">
	        <p>質問2: 世界で一番高い山は？</p>
	        <input type="radio" id="q2_a" name="question2" value="エベレスト">
	        <label for="q2_a">エベレスト</label><br>

	        <input type="radio" id="q2_b" name="question2" value="富士山">
	        <label for="q2_b">富士山</label><br>

	        <input type="radio" id="q2_c" name="question2" value="モンブラン">
	        <label for="q2_c">モンブラン</label><br><br>

	        <input type="button" id="submitBtn" value="送信" onclick="submitForm()">
	    </div>
	</form>
	<div id="exitSection" class="input-section">
	<h2>ご回答ありがとうございました!</h2>
	</div>

	<script>
		document.getElementById('loginSection').style.display = 'block';
		
		
		function showNextSection(sectionId) {
			console.log("Showing section: " + sectionId);
			const currentSection = document.querySelector('.input-section:not([style*="display: none"])');
			if (currentSection) {
				currentSection.style.display = 'none';
			}
			document.getElementById(sectionId).style.display = 'block';
		}
		
		
		function startQuiz(sectionId) {
			let name = document.getElementById("inputNameBox").value;
			if (name.trim() === "") {
				alert("名前を入力してください。");
				return;
			} else if (name.length > 10) {
				alert("名前は10文字以内で入力してください。");
				return;
			}
			document.getElementById("welcomeMessage").innerText = `${name} さん、クイズを始めましょう！`;
			showNextSection(sectionId);
		}
		
		
		const url = "https://script.google.com/macros/s/AKfycbzL31iwqTDoJdt-n17ACUcm75dl68Uy5YvHgoPtWZWsqVvEJMVfjcNY3ybA3rrbznbswg/exec";
		
		function receiveForm() {
			document.getElementById("passwdBtn").disabled = true;

			const inputValue = document.getElementById('passwdBox').value;

			const GET_options = {
				method: "GET",
			};

			fetch(url, GET_options)
			.then(response => response.json())
			.then(data => {
			const cellValue = data.cellValue;
			if (inputValue == cellValue) {
			  showNextSection('inputNameSection');
			} else {
			  document.getElementById("resultBox").innerText = "パスワードが間違っています。再度入力してください。";
			  document.getElementById("passwdBtn").disabled = false;
			}
			})
			.catch((error) => {console.error('Error:', error);});
		}
		
		function submitForm() {
			document.getElementById("submitBtn").disabled = true;
			const formData = new FormData(document.getElementById('testForm'));
			const data = {};
			formData.forEach((value, key) => {
				data[key] = value;
			});

			const POST_options = {
				method: "POST",
				body: JSON.stringify(data),
			};

			fetch(url, POST_options)
			.then(response => response.json())
			.then(response => {
	            if (response.result === true) {
	            	showNextSection('exitSection');
	            } else {
	                alert("送信失敗。もう一度試してください。");
	                document.getElementById("submitBtn").disabled = false;
	            }
	        })
	        .catch(error => {
	            console.error('Error:', error);
	            alert("エラーが発生しました。もう一度試してください。");
	            document.getElementById("submitBtn").disabled = false;
	        });
	    }

	</script>
</body>
</html>
